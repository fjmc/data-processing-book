<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title></title>
    <style type="text/css">code{white-space: pre;}</style>
    <link rel="stylesheet" href="pandoc.css">
    <!--[if lt IE 9]>
        <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
    <![endif]-->
</head>
<body>
<h1 id="module-3-uniprot-as-a-web-service">Module 3 – UniProt as a web service</h1>
<h2 id="objectives">Objectives:</h2>
<ul>
<li>Recognize the importance of external sources of data</li>
<li>Use a web service through Python code</li>
<li>Process information coming from a web service</li>
</ul>
<h2 id="input">Input:</h2>
<ul>
<li>File: <a href="files/selected2.csv">selected2.csv</a>
<ul>
<li>created in the previous module</li>
</ul></li>
</ul>
<h2 id="output">Output:</h2>
<ul>
<li>File: <code>sequences.csv</code>
<ul>
<li>containing the aminoacid sequences for each enzyme</li>
</ul></li>
</ul>
<h2 id="steps">Steps:</h2>
<ol type="1">
<li><p>Go to <a href="http://www.uniprot.org/uniprot/P12345.fasta" class="uri">http://www.uniprot.org/uniprot/P12345.fasta</a> and study the FASTA format. Try to change the identifier in the link from <code>P12345</code> to another one.</p></li>
<li><p>In a Python file named <code>module3.py</code>, create a function called <code>get_sequence</code> that takes as input the ID of a protein and returns its aminoacid sequence. This function:</p>
<ol type="a">
<li><p>opens the URL mentioned above,</p></li>
<li><p>reads the content on that URL,</p></li>
<li><p>extracts the aminoacid sequence, and</p></li>
<li><p>joins all the lines so that only a single string is returned</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> urllib <span class="co"># This module contains functions to read URLs</span>

<span class="kw">def</span> get_sequence(ID):
    <span class="co"># Establish the URL to open</span>
    url <span class="op">=</span> <span class="st">&#39;http://www.uniprot.org/uniprot/&#39;</span> <span class="op">+</span> ??? <span class="op">+</span> <span class="st">&#39;.fasta&#39;</span>

    <span class="co"># Open the URL</span>
    f <span class="op">=</span> urllib.urlopen(url)

    <span class="co"># Read all the lines into a list</span>
    lines <span class="op">=</span> f.readlines()

    <span class="co"># Ignore the first line, which contains metadata</span>
    <span class="kw">del</span> lines[<span class="dv">0</span>]

    <span class="co"># Join all the remaining lines into a single string</span>
    sequence <span class="op">=</span> <span class="bu">str</span>.join(<span class="st">&quot;&quot;</span>, lines)

    <span class="co"># Remove the line ends (the &quot;enter&quot; used to start the next line)</span>
    <span class="co"># This line end is represented as \n</span>
    sequence <span class="op">=</span> <span class="bu">str</span>.replace(sequence, <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>, <span class="st">&#39;&#39;</span>)

    <span class="co"># Return the sequence</span>
    <span class="cf">return</span> ???</code></pre></div></li>
</ol></li>
<li><p>Let’s try our function on a couple of proteins. To do that, add the following lines to the Python file (replace the <code>???</code> instances with any protein IDs you want):</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">sequence1 <span class="op">=</span> get_sequence(<span class="st">&#39;P12345&#39;</span>)
sequence2 <span class="op">=</span> get_sequence(<span class="st">&#39;???&#39;</span>)
sequence3 <span class="op">=</span> get_sequence(<span class="st">&#39;???&#39;</span>)

<span class="bu">print</span> <span class="st">&quot;SEQUENCE 1:</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> sequence1 <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>
<span class="bu">print</span> <span class="st">&quot;SEQUENCE 2:</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> sequence2 <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>
<span class="bu">print</span> <span class="st">&quot;SEQUENCE 3:</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> sequence3 <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></code></pre></div></li>
<li><p>Now we are going to read the enzymes in the <code>selected2.csv</code> file and perform a lookup of their aminoacid sequences.</p>
<ol type="a">
<li><p>Remove or comment the code from step 3.</p></li>
<li><p>Replace it with this:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> csv

<span class="co"># Open the output file from the previous module</span>
f <span class="op">=</span> <span class="bu">open</span>(<span class="st">&#39;selected2.csv&#39;</span>)
paths <span class="op">=</span> csv.reader(f, delimiter<span class="op">=</span>???)

<span class="co"># Start with an empty list of enzymes</span>
enzymes <span class="op">=</span> []

<span class="co"># Then:</span>
<span class="co"># - read the information of each pathway,</span>
<span class="co"># - extract the list of enzymes of each pathway, and</span>
<span class="co"># - append each enzyme to the list of enzymes</span>
<span class="cf">for</span> path <span class="op">in</span> paths:
    enzymes_field <span class="op">=</span> path[???] <span class="co"># The field of the enzymes</span>

    <span class="co"># Split the enzymes into a list, as in module 2</span>
    enzymes_in_this_path <span class="op">=</span> <span class="bu">str</span>.split(enzymes_field, ???)

    <span class="co"># Append each one into the master enzyme list</span>
    <span class="cf">for</span> e <span class="op">in</span> enzymes_in_this_path:
        enzymes.append(e)</code></pre></div></li>
</ol></li>
<li><p>Now that we have a list of enzymes, we can use it and the function we created in the beginning to get the aminoacid sequence of each enzyme. We will save this information into a new file. Continue adding code to your <code>module3.py</code> file:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">f <span class="op">=</span> <span class="bu">open</span>(<span class="st">&#39;sequences.csv&#39;</span>, <span class="st">&#39;w&#39;</span>)
w <span class="op">=</span> csv.writer(f, delimiter<span class="op">=</span>???)

<span class="cf">for</span> e <span class="op">in</span> enzymes:
    seq <span class="op">=</span> get_sequence(e)
    w.writerow([e, seq])

f.close()</code></pre></div></li>
<li><p>Run the code and take notice of the file that was created (<code>sequences.csv</code>). Does it correspond to what you were expecting to see?</p></li>
<li><p>Make sure you keep a copy of the <code>sequences.csv</code> file to yourself, so that you can use it in the next modules. For example, send it to you by email or upload it to Dropbox.</p></li>
<li><p>Submit your code and the answers to the quiz below to moodle.</p></li>
</ol>
<h2 id="quiz">Quiz:</h2>
<ol type="1">
<li><p>Observe in <code>sequences.csv</code> that some enzymes appear more than once. Can you explain why?</p></li>
<li><p>Describe the code in step 5 line by line. Use comments to do it.</p></li>
</ol>
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script>

// Replace all instances of "???" inside <code> elements with the HTML code:
// <span class="blank">?</span>
$("code").html(function () {
    return $(this).html().replace(/\?\?\?/g, "<span class=\"blank\">?</span>");
});

// "print" is a builtin in python3 but a keyworkd in python2.
// Let's make sure this change happens
$("span.bu").each(function() {
    if ($(this).text() == "print") {
        $(this).removeClass('bu');
        $(this).addClass('kw');
    }
})

</script>
</body>
</html>
